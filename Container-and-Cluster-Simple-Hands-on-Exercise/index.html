<!DOCTYPE html><html lang="zh"><head><meta name="google-site-verification" content="6dKXSVBE3ZyVxHtiFCvc57UwP5MEzcp51X7Wn5okSoE"><link rel="icon" href="/api/images/tianzhen.jpg"><script>document.addEventListener("DOMContentLoaded",function(){var e;768<=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)&&((e=document.createElement("script")).src="/api/js/fireworks.min.js",document.head.appendChild(e),(e=document.createElement("script")).src="/api/js/background.min.js",document.head.appendChild(e),(e=document.createElement("script")).src="/api/js/cursor.min.js",document.head.appendChild(e),(e=document.createElement("canvas")).id="fireworks",e.style.cssText="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767",document.body.appendChild(e),(e=document.createElement("canvas")).id="background",e.style.cssText="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1",document.body.appendChild(e),(e=document.createElement("div")).id="cursor",document.body.appendChild(e))})</script><meta charset="utf-8"><title>容器与集群小实训 | Tianzhen</title><meta name="author" content="Tianzhen"><meta name="description" content="My Learning Journey Blog"><meta name="keywords" content="seo优化 javaweb教程 网络技术分享"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><link rel="preconnect" href="https://cdn.staticfile.org"><link rel="preconnect" href="https://tiantwikoo.netlify.app"><link rel="preconnect" href="/api"><script src="/api/js/vue.global.prod.min.js"></script><script src="/api/js/anime.min.js"></script><script async src="https://umami.hoshiroko.com/script.js" data-website-id="6c968d09-0bb6-4304-a28c-7944d8474aad"></script><link rel="stylesheet" href="/api/fontawesome/fontawesome6.5.1/css/all.min.css"><link rel="stylesheet" href="/api/css/fonts/fonts.loli.net.min.css"><script>const mixins={}</script><script src="/api/js/highlight.min.js"></script><script src="https://cdn.staticfile.org/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/11.9.0/styles/github.min.css"><script src="/api/js/lib/highlight.js"></script><script src="/api/js/lib/preview.js"></script><script src="https://cdn.staticfile.org/twikoo/1.6.27/twikoo.all.min.js"></script><link rel="stylesheet" href="/api/css/main.css"><meta name="generator" content="Hexo 6.3.0"></head><script>var st,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="o(இ௰இ)怎么就走了！",clearTimeout(st)):(document.title="☆*o(≧▽≦)o*☆欢迎回来！",st=setTimeout(function(){document.title=OriginTitile},3e3))})</script><body><div id="layout"><transition name="fade"><div id="loading" v-show="loading"><div id="loading-circle"><h2>LOADING</h2><p>加载过慢请开启缓存 浏览器默认开启</p><img src="/api/images/loading.gif"></div></div></transition><div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}"><nav id="desktop-menu"><a class="title" href="/"><span>TIANZHEN</span> </a><a href="/"><i class="fa-solid fa-house fa-fw"></i> <span>&ensp;Home</span> </a><a href="/about"><i class="fa-solid fa-id-card fa-fw"></i> <span>&ensp;About</span> </a><a href="/archives"><i class="fa-solid fa-box-archive fa-fw"></i> <span>&ensp;Archives</span> </a><a href="/categories"><i class="fa-solid fa-bookmark fa-fw"></i> <span>&ensp;Categories</span> </a><a href="/tags"><i class="fa-solid fa-tags fa-fw"></i> <span>&ensp;Tags</span> </a><a target="_blank" rel="noopener" href="https://umami.hoshiroko.com/share/jpoapxn7zGXoKcSv/tianzhentech"><i class="fa-solid fa-chart-column fa-fw"></i> <span>&ensp;Umami</span></a></nav><nav id="mobile-menu"><div class="title" @click="showMenuItems = !showMenuItems"><i class="fa-solid fa-bars fa-fw"></i> <span>&emsp;TIANZHEN</span></div><transition name="slide"><div class="items" v-show="showMenuItems"><a href="/"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-house fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Home</div></div></a><a href="/about"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-id-card fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">About</div></div></a><a href="/archives"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-box-archive fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Archives</div></div></a><a href="/categories"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-bookmark fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Categories</div></div></a><a href="/tags"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-tags fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Tags</div></div></a></div></transition></nav></div><transition name="fade"><div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div></transition><div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'"><div class="article"><div><h1>容器与集群小实训</h1></div><div class="info"><span class="date"><span class="icon"><i class="fa-solid fa-calendar fa-fw"></i> </span>2023/12/20 </span><span class="category"><a href="/categories/%E4%B8%AA%E4%BA%BA%E7%BA%AA%E5%BD%95/"><span class="icon"><i class="fa-solid fa-bookmark fa-fw"></i> </span>个人纪录 </a></span><span class="tags"><span class="icon"><i class="fa-solid fa-tags fa-fw"></i> </span><span class="tag"><a href="/tags/k8s/" style="color:#ffa2c4">k8s</a> </span><span class="tag"><a href="/tags/docker/" style="color:#ff7d73">docker</a></span></span></div><div class="content" v-pre><h1><span id="目录">目录</span></h1><ul><li><a href="#%E5%AE%9E%E8%AE%AD%E7%AE%80%E4%BB%8B">实训简介</a></li><li><a href="#1-mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85">1. MySQL数据库安装</a><ul><li><a href="#k8s%E9%83%A8%E7%BD%B2mysql">k8s部署MySQL</a><ul><li><a href="#1-%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%BB%E4%B8%A4%E4%BB%8Ek8s%E9%9B%86%E7%BE%A4">1. 搭建一主两从k8s集群</a><ul><li><a href="#1-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE">1. 服务器配置</a></li><li><a href="#2-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">2. 准备工作</a><ul><li><a href="#%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99">关闭防火墙</a></li><li><a href="#%E5%85%B3%E9%97%ADselinux">关闭SELinux</a></li><li><a href="#%E5%85%B3%E9%97%ADswap">关闭Swap</a></li><li><a href="#%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D">设置主机名</a></li><li><a href="#%E4%BF%AE%E6%94%B9host%E6%96%87%E4%BB%B6">修改host文件</a></li><li><a href="#%E5%B0%86%E6%A1%A5%E6%8E%A5%E7%9A%84-ipv4-%E6%B5%81%E9%87%8F%E4%BC%A0%E9%80%92%E5%88%B0-iptables">将桥接的 IPv4 流量传递到 iptables</a></li><li><a href="#%E5%90%8C%E6%AD%A5%E6%97%B6%E9%97%B4">同步时间</a></li></ul></li><li><a href="#3-%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85kubernetes">3. 开始安装Kubernetes</a><ul><li><a href="#%E5%AE%89%E8%A3%85docker">安装docker</a></li><li><a href="#docker%E9%98%BF%E9%87%8C%E4%BA%91%E5%8A%A0%E9%80%9F%E9%85%8D%E7%BD%AEhttpscrconsolealiyuncomcn-shenzheninstancesmirrors">docker<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors">阿里云加速配置</a></a></li><li><a href="#%E6%B7%BB%E5%8A%A0k8s%E7%9A%84yum%E6%BA%90">添加K8S的yum源</a></li><li><a href="#%E5%AE%89%E8%A3%85-kubelet-kubeadm-%E5%92%8C-kubectl">安装 <code>kubelet</code>、<code>kubeadm</code> 和 <code>kubectl</code></a></li></ul></li><li><a href="#4-kubernetes%E5%90%AF%E5%8A%A8">4. Kubernetes，启动！</a><ul><li><a href="#%E5%90%AF%E5%8A%A8master">启动master</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E5%90%AF%E5%8A%A8%E4%BF%A1%E6%81%AF">获取启动信息</a></li><li><a href="#%E5%90%AF%E5%8A%A8%E4%B8%A4%E4%B8%AAslavenode%E8%8A%82%E7%82%B9%E6%89%A7%E8%A1%8C">启动两个Slave（node节点执行）</a></li><li><a href="#%E4%B8%BA-master-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6">为 <code>master</code> 安装网络插件</a></li></ul></li></ul></li><li><a href="#2-%E5%9C%A8%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2mysql">2. 在集群上部署MySQL</a><ul><li><a href="#1-%E5%88%9B%E5%BB%BAnamespace%E6%8A%8Amysql%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%8D%95%E7%8B%AC%E7%9A%84%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4%E4%B8%AD">1. 创建namespace，把mysql部署在单独的名称空间中</a></li><li><a href="#2-%E5%88%9B%E5%BB%BA%E6%8C%81%E4%B9%85%E5%8D%B7pv%E7%94%A8%E6%9D%A5%E5%AD%98%E5%82%A8mysql%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6">2. 创建持久卷PV，用来存储mysql数据文件</a><ul><li><a href="#1-%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%AE%B9%E9%87%8F%E5%A4%A7%E5%B0%8F%E4%B8%BA1gb%E7%9A%84pv%E6%8C%82%E8%BD%BD%E5%88%B0nfsdata01%E7%9B%AE%E5%BD%95">1. 定义一个容量大小为1GB的PV，挂载到<code>/nfs/data/01</code>目录</a></li><li><a href="#2-%E7%BC%96%E5%86%99mysql-pvyaml%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E8%A6%81%E5%88%9B%E5%BB%BA%E7%9A%84pv%E5%AF%B9%E8%B1%A1%E5%90%8D%E7%A7%B0pv-1gi">2. 编写mysql-pv.yaml文件内容，要创建的pv对象名称：pv-1gi</a></li><li><a href="#3-%E5%88%9B%E5%BB%BA%E8%AF%A5pv%E5%AF%B9%E8%B1%A1">3. 创建该PV对象</a></li><li><a href="#4-%E6%9F%A5%E7%9C%8B%E5%88%9B%E5%BB%BA%E7%BB%93%E6%9E%9C">4. 查看创建结果</a></li></ul></li><li><a href="#3-%E5%88%9B%E5%BB%BA%E6%8C%81%E4%B9%85%E5%8D%B7%E5%A3%B0%E6%98%8Epvc">3. 创建持久卷声明PVC</a><ul><li><a href="#1-%E5%88%9B%E5%BB%BA%E6%8C%81%E4%B9%85%E5%8D%B7%E5%A3%B0%E6%98%8Epvc">1. 创建持久卷声明PVC</a></li><li><a href="#2-%E5%88%9B%E5%BB%BA%E8%AF%A5pvc%E5%AF%B9%E8%B1%A1">2. 创建该PVC对象</a></li><li><a href="#3-%E6%9F%A5%E7%9C%8B%E5%88%9B%E5%BB%BA%E7%BB%93%E6%9E%9C">3. 查看创建结果</a></li></ul></li><li><a href="#4-%E5%88%9B%E5%BB%BAsecret%E5%AF%B9%E8%B1%A1%E7%94%A8%E6%9D%A5%E4%BF%9D%E5%AD%98mysql%E7%9A%84root%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81">4. 创建Secret对象用来保存mysql的root用户密码</a><ul><li><a href="#1-%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81%E4%B8%BA123456%E6%89%A7%E8%A1%8C%E5%88%9B%E5%BB%BA%E5%91%BD%E4%BB%A4">1. 设置密码为123456，执行创建命令</a></li><li><a href="#2-%E6%9F%A5%E7%9C%8B%E5%88%9B%E5%BB%BA%E7%BB%93%E6%9E%9C">2. 查看创建结果</a></li></ul></li><li><a href="#5-%E5%88%9B%E5%BB%BAservice">5. 创建service</a><ul><li><a href="#1-%E7%BC%96%E8%BE%91mysql-svcyaml%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9">1. 编辑mysql-svc.yaml文件内容</a></li><li><a href="#2-%E6%89%A7%E8%A1%8C%E5%88%9B%E5%BB%BA%E5%91%BD%E4%BB%A4">2. 执行创建命令</a></li><li><a href="#3-%E6%9F%A5%E7%9C%8B%E5%88%9B%E5%BB%BA%E7%BB%93%E6%9E%9C-1">3. 查看创建结果</a></li></ul></li></ul></li></ul></li><li><a href="#docker%E9%83%A8%E7%BD%B2mysql">docker部署MySQL</a></li></ul></li><li><a href="#2-mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E7%BD%AE%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95">2. MySQL数据库设置远程登录</a><ul><li><a href="#k8s%E8%BF%9B%E5%85%A5mysql%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8">k8s进入MySQL容器内部</a></li><li><a href="#docker%E8%BF%9B%E5%85%A5mysql%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8">docker进入MySQL容器内部</a></li><li><a href="#%E9%85%8D%E7%BD%AEroot%E7%94%A8%E6%88%B7%E8%BF%9C%E7%A8%8B%E5%8F%AF%E8%BF%9E%E6%8E%A5">配置root用户远程可连接</a></li><li><a href="#%E5%88%9B%E5%BB%BAmydb%E5%BA%93%E5%B9%B6%E6%8E%88%E6%9D%83%E7%BB%99root%E7%94%A8%E6%88%B7">创建mydb库并授权给root用户</a></li></ul></li><li><a href="#3-%E7%94%A8navicat%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E5%AE%8C%E6%88%90%E5%BB%BA%E8%A1%A8">3. 用navicat连接数据库并完成建表</a><ul><li><a href="#%E8%BF%9E%E6%8E%A5k8s%E4%B8%8B%E7%9A%84mysql%E6%95%B0%E6%8D%AE%E5%BA%93">连接k8s下的MySQL数据库</a></li><li><a href="#%E8%BF%9E%E6%8E%A5docker%E4%B8%8B%E7%9A%84mysql%E6%95%B0%E6%8D%AE%E5%BA%93">连接docker下的MySQL数据库</a></li></ul></li><li><a href="#4-%E5%88%B6%E4%BD%9Cdockerfile%E5%B9%B6%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8">4. 制作dockerfile并创建镜像，运行容器</a><ul><li><a href="#1-%E5%88%9B%E5%BB%BA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84dockerfile">1. 创建定时任务的Dockerfile</a></li><li><a href="#2-%E7%BC%96%E5%86%99scriptsh%E5%92%8Cmysqlpy">2. 编写script.sh和mysql.py</a><ul><li><a href="#scriptsh">script.sh:</a></li><li><a href="#mysqlpy">mysql.py:</a></li></ul></li><li><a href="#3-%E5%88%A9%E7%94%A8dockerfile%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F">3. 利用Dockerfile创建镜像</a></li><li><a href="#4-%E8%BF%90%E8%A1%8C%E5%B9%B6%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8%E9%85%8D%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E8%8B%A5crond-%E6%9C%AA%E5%90%AF%E5%8A%A8%E7%9B%B4%E6%8E%A5%E8%BF%90%E8%A1%8C%E6%AD%A4%E5%91%BD%E4%BB%A4">4. 运行并进入容器内部，配置定时任务（若crond 未启动，直接运行此命令）</a></li><li><a href="#5-%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%9C">5. 查看数据库结果</a><ul><li><a href="#k8s%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%9C">k8s数据库结果：</a></li><li><a href="#docker%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%9C">docker数据库结果：</a></li></ul></li></ul></li><li><a href="#5-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E5%B9%B6%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93">5. 构建镜像并推送到阿里云镜像仓库</a><ul><li><a href="#1-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F">1. 构建镜像</a></li><li><a href="#2-%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93">2. 推送到阿里云镜像仓库</a><ul><li><a href="#1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">1. 准备工作</a><ul><li><a href="#1-%E6%89%BE%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1acr%E5%B9%B6%E6%89%93%E5%BC%80%E6%8E%A7%E5%88%B6%E5%8F%B0">1. 找到阿里云容器镜像服务ACR，并打开控制台：</a></li><li><a href="#2-%E6%89%BE%E5%88%B0%E4%B8%AA%E4%BA%BA%E5%AE%9E%E4%BE%8B%E5%85%88%E5%88%9B%E5%BB%BA%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4">2. 找到个人实例，先创建命名空间：</a></li><li><a href="#3-%E5%9C%A8%E8%AF%A5%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93my-docker-crond%E6%B3%A8%E6%84%8F%E5%9C%B0%E5%9F%9F">3. 在该命名空间下创建一个镜像仓库<code>my-docker-crond</code>，注意地域：</a></li></ul></li><li><a href="#2-%E7%99%BB%E5%BD%95%E9%98%BF%E9%87%8C%E4%BA%91docker-registry">2. 登录阿里云Docker Registry</a></li><li><a href="#3-tagandpush">3. <code>tag</code>and<code>push</code></a></li><li><a href="#4-%E4%BB%93%E5%BA%93%E9%AA%8C%E8%AF%81">4. 仓库验证</a></li></ul></li></ul></li><li><a href="#%E5%AE%9E%E8%AE%AD%E6%80%BB%E7%BB%93">实训总结</a></li></ul><h1><span id="实训简介">实训简介</span></h1><p>搭建一主两从k8s集群并部署MySQL（可用docker搭建MySQL），构建Python爬虫镜像，定时爬取网页内容并持久化到数据库，把镜像推送到阿里云镜像仓库。</p><h1><span id="1-mysql数据库安装">1. MySQL数据库安装</span></h1><h2><span id="k8s部署mysql">k8s部署MySQL</span></h2><h3><span id="1-搭建一主两从k8s集群">1. 搭建一主两从k8s集群</span></h3><h4><span id="1-服务器配置">1. 服务器配置</span></h4><p>需要三台服务器，ip在同一网段，使其可以互相通信，三台服务器可以连接外网，配置不能太低，要满足docker运行要求，建议2核2g，硬盘20g即可，本次实训用的镜像是<code>CentOS 7.9</code>。</p><p>类似于这种：</p><p><img loading="lazy" src="/../images/398bbf94c0244a7a815ecb277f4118bf.png" alt="img"></p><h4><span id="2-准备工作">2. 准备工作</span></h4><blockquote><p>下面这些操作，三台机器都要执行！</p></blockquote><h5><span id="关闭防火墙">关闭防火墙</span></h5><pre><code class="bash">systemctl stop firewalld
systemctl disable firewalld
</code></pre><h5><span id="关闭selinux">关闭SELinux</span></h5><pre><code class="bash"># 永久关闭
sed -i &#39;s/enforcing/disabled/&#39; /etc/selinux/config
# 临时关闭
setenforce 0
</code></pre><h5><span id="关闭swap">关闭Swap</span></h5><pre><code class="bash"># 永久关闭
vim /etc/fstab
# 临时关闭
swapoff -a
</code></pre><p>永久关闭的时候需要注释这一行（带swap）</p><p><img loading="lazy" src="/../images/image-20231220212508717.png" alt="image-20231220212508717"></p><h5><span id="设置主机名">设置主机名</span></h5><ul><li>192.168.154.130: <code>hostnamectl set-hostname k8s-master</code></li><li>192.168.154.131: <code>hostnamectl set-hostname k8s-node1</code></li><li>192.168.154.132: <code>hostnamectl set-hostname k8s-node2</code></li></ul><p>设置完成后：</p><pre><code class="bash">#192.168.154.130
[root@localhost log]# hostname
k8s-master
#192.168.154.131
[root@localhost log]# hostname
k8s-node1
#192.168.154.130
[root@localhost log]# hostname
k8s-node2
</code></pre><h5><span id="修改host文件">修改host文件</span></h5><pre><code class="bash">cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.154.130 k8s-master
192.168.154.131 k8s-node1
192.168.154.132 k8s-node2
EOF
</code></pre><h5><span id="将桥接的-ipv4-流量传递到-iptables">将桥接的 IPv4 流量传递到 iptables</span></h5><pre><code class="bash">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
</code></pre><p>使其生效：</p><pre><code class="bash">sysctl --system
</code></pre><h5><span id="同步时间">同步时间</span></h5><pre><code class="bash">yum install ntpdate -y
ntpdate time.windows.com
</code></pre><h4><span id="3-开始安装kubernetes">3. 开始安装Kubernetes</span></h4><blockquote><p>三台服务器都需要完成以下配置</p></blockquote><h5><span id="安装docker">安装docker</span></h5><p>每台电脑都需要安装docker，可执行一下脚本：</p><pre><code class="bash">#!/bin/bash
sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
sudo yum install -y yum-utils
sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install -y docker-ce docker-ce-cli containerd.io
sudo systemctl start docker
sudo systemctl enable docker
</code></pre><p>以上脚本执行完之后docker就安装好了</p><h5><span id="docker阿里云加速配置">docker</span></h5><p>复制以下代码：</p><p><img loading="lazy" src="/../images/image-20231220214325578.png" alt="image-20231220214325578"></p><p>然后在中括号下面加上一行代码：</p><pre><code class="json">&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]
</code></pre><p>添加完成后：</p><pre><code class="bash">sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;
&#123;
  &quot;registry-mirrors&quot;: [&quot;https://xxxxx.mirror.aliyuncs.com&quot;],
  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]
&#125;
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre><h5><span id="添加k8s的yum源">添加K8S的yum源</span></h5><p>执行以下代码：</p><pre><code class="bash">cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF
</code></pre><h5><span id="安装-kubelet-kubeadm-和-kubectl">安装 <code>kubelet</code>、<code>kubeadm</code> 和 <code>kubectl</code></span></h5><p>通过以下命令安装：</p><pre><code class="bash">yum install -y kubelet-1.23.6 kubeadm-1.23.6 kubectl-1.23.6
systemctl enable kubelet
</code></pre><h4><span id="4-kubernetes启动">4. Kubernetes，启动！</span></h4><h5><span id="启动master">启动master</span></h5><p>查看版本：</p><pre><code class="bash">kubeadm version
</code></pre><p>如图：</p><p><img loading="lazy" src="/../images/image-20231220215728473.png" alt="image-20231220215728473"></p><p>然后执行命令启动：</p><pre><code class="bash">kubeadm init \
--apiserver-advertise-address=192.168.154.130 \
--image-repository registry.aliyuncs.com/google_containers \
--kubernetes-version v1.23.6 \
--service-cidr=10.96.0.0/12 \
--pod-network-cidr=10.244.0.0/16
</code></pre><p>注意 <code>--apiserver-advertise-address=192.168.154.130</code> 后面的IP地址需要改成自己mater的IP，然后 <code>--kubernetes-version v1.23.6</code> 的版本注意改成自己K8S的版本。</p><h5><span id="获取启动信息">获取启动信息</span></h5><p>查看启动成功的信息</p><p><img loading="lazy" src="/../images/image-20231220222053749.png" alt="image-20231220222053749"></p><p>本机执行这些命令（以上面截图的为准）：</p><pre><code class="bash">  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre><h5><span id="启动两个slavenode节点执行">启动两个Slave（node节点执行）</span></h5><p>还记得上面需要记录下来的命令吗，就是这行：</p><pre><code class="bash">kubeadm join 192.168.154.130:6443 --token 7vdvuj.5kvyhzz3ks3tspuy \
    --discovery-token-ca-cert-hash sha256:931aeb772e89b669e2eed1405edbe269a7801d133b63a440cd0efba3b7dbad95 
</code></pre><p>执行它，查看结果：</p><p><img loading="lazy" src="/../images/image-20231220222935591.png" alt="image-20231220222935591"></p><h5><span id="为-master-安装网络插件">为 <code>master</code> 安装网络插件</span></h5><p>我们在master中执行这一行命令：</p><pre><code class="bash">kubectl get nodes
</code></pre><p>查看结果：</p><p><img loading="lazy" src="/../images/image-20231220223222109.png" alt="image-20231220223222109"></p><p>可以看到两个node成功注册，但是没能达到准备状态，因为 <code>STATUS</code> 仍然是 <code>NotReady</code> 状态，我们需要为 <code>master</code> 安装网络插件：</p><pre><code class="bash">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</code></pre><p>看到这个代表安装成功（如果没有安装成功，那么需要将文件下载下来，然后将url替换成下载下来的文件）：</p><p><img loading="lazy" src="/../images/image-20231220223413034.png" alt="image-20231220223413034"></p><p>但是还需要等一下，因为他正在联网下载依赖呢，然后再次查看，就变为 <code>Ready</code> 状态了：</p><p><img loading="lazy" src="/../images/image-20231220231354683.png" alt="image-20231220231354683"></p><p>我这个node1节点有问题，我找了许久还是报错，最后我放弃了，因为一个节点不影响MySQL的部署，我还是决定先继续做实验，回头重新安装k8s试试，应该是漏了某个步骤，而正常的应该是这种：</p><p><img loading="lazy" src="/../images/5815701651904fef98df28c2a2e74050.png" alt="img"></p><p>如果如上图所示，那你的一主两从集群就部署成功了，中间会遇到各种各样的报错，你可以选择执行某些命令时忽略这些错误项，但是还有一些问题是需要自己解决的。</p><hr><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_51510236/article/details/123477488">CentOS7上搭建Kubernetes（K8S）集群并部署nginx（kubeadm方式）_k8s高可用 centos+nginx+kubeadm-CSDN博客</a></p><h3><span id="2-在集群上部署mysql">2. 在集群上部署MySQL</span></h3><h4><span id="1-创建namespace把mysql部署在单独的名称空间中">1. 创建namespace，把mysql部署在单独的名称空间中</span></h4><pre><code class="bash">kubectl create namespace dev
</code></pre><h4><span id="2-创建持久卷pv用来存储mysql数据文件">2. 创建持久卷PV，用来存储mysql数据文件</span></h4><h5><span id="1-定义一个容量大小为1gb的pv挂载到nfsdata01目录">1. 定义一个容量大小为1GB的PV，挂载到<code>/nfs/data/01</code>目录</span></h5><pre><code class="bash">mkdir -p /nfs/data/01
</code></pre><h5><span id="2-编写mysql-pvyaml文件内容要创建的pv对象名称pv-1gi">2. 编写mysql-pv.yaml文件内容，要创建的pv对象名称：pv-1gi</span></h5><pre><code class="yaml">apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-1gi
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteMany
  storageClassName: nfs
  nfs:
    path: /nfs/data/01
    server: 192.168.154.130
</code></pre><h5><span id="3-创建该pv对象">3. 创建该PV对象</span></h5><pre><code class="bash">kubectl create -f mysql-pv.yaml
</code></pre><h5><span id="4-查看创建结果">4. 查看创建结果</span></h5><pre><code class="bash">kubectl get pv
kubectl describe pv pv-1gi
</code></pre><p>如图：</p><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-20%20182529.png" alt="屏幕截图 2023-12-20 182529"></p><p><img loading="lazy" src="/../images/image-20231220234114072.png" alt="image-20231220234114072"></p><h4><span id="3-创建持久卷声明pvc">3. 创建持久卷声明PVC</span></h4><h5><span id="1-创建持久卷声明pvc">1. 创建持久卷声明PVC</span></h5><p>编写mysql-pvc.yaml文件内容，要创建的pvc对象名称是：mysql-pvc</p><pre><code class="yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pvc
  namespace: dev
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 1Gi
  storageClassName: nfs
</code></pre><h5><span id="2-创建该pvc对象">2. 创建该PVC对象</span></h5><pre><code class="bash">kubectl create -f mysql-pvc.yaml
</code></pre><h5><span id="3-查看创建结果">3. 查看创建结果</span></h5><pre><code class="bash">kubectl get pvc -n dev
</code></pre><p>可以看到mysql-pvc对象已经和pv-1gi对象绑定上了：</p><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-20%20182758.png" alt="屏幕截图 2023-12-20 182758"></p><h4><span id="4-创建secret对象用来保存mysql的root用户密码">4. 创建Secret对象用来保存mysql的root用户密码</span></h4><h5><span id="1-设置密码为123456执行创建命令">1. 设置密码为123456，执行创建命令</span></h5><pre><code class="bash">kubectl create secret generic mysql-root-password --from-literal=password=123456 -n dev
</code></pre><h5><span id="2-查看创建结果">2. 查看创建结果</span></h5><pre><code class="bash">kubectl get secret -n dev
kubectl get secret mysql-root-password -n dev -o yaml
</code></pre><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-20%20182855.png" alt="屏幕截图 2023-12-20 182855"></p><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-20%20182919.png" alt="屏幕截图 2023-12-20 182919"></p><h4><span id="5-创建service">5. 创建service</span></h4><h5><span id="1-编辑mysql-svcyaml文件内容">1. 编辑mysql-svc.yaml文件内容</span></h5><pre><code class="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: mysql
  name: mysql
  namespace: dev
spec:
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - image: mysql:8.0
        name: mysql
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-root-password
              key: password 
        ports:
        - containerPort: 3306
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: svc-mysql
  name: svc-mysql
  namespace: dev
spec:
  selector:
    app: mysql
  type: NodePort
  ports:
  - port: 3306
    protocol: TCP
    targetPort: 3306
    nodePort: 31233
</code></pre><p>service使用NodePort类型，指定暴露的nodePort端口为31233，我们会在宿主机使用navicat客户端对mysql进行访问。</p><h5><span id="2-执行创建命令">2. 执行创建命令</span></h5><pre><code class="bash">kubectl create -f mysql-svc.yaml
</code></pre><h5><span id="3-查看创建结果">3. 查看创建结果</span></h5><pre><code class="bash">kubectl get pod,svc -n dev
</code></pre><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-20%20183128.png" alt="屏幕截图 2023-12-20 183128"></p><h2><span id="docker部署mysql">docker部署MySQL</span></h2><pre><code class="bash">docker run --name mysql -e MYSQL_ROOT_PASSWORD=123456 -p 3306:3306 -d mysql
</code></pre><h1><span id="2-mysql数据库设置远程登录">2. MySQL数据库设置远程登录</span></h1><h2><span id="k8s进入mysql容器内部">k8s进入MySQL容器内部</span></h2><pre><code class="bash">kubectl exec -it mysql-657494c4df-thlqf  /bin/bash -n dev
</code></pre><p>其中<code>mysql-657494c4df-thlqf</code>是mysql数据库所在pod的pod名称。</p><h2><span id="docker进入mysql容器内部">docker进入MySQL容器内部</span></h2><pre><code class="bash">docker exec -it 容器名or容器id /bin/bash
</code></pre><h2><span id="配置root用户远程可连接">配置root用户远程可连接</span></h2><pre><code class="mysql">ALTER USER root@localhost IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;
ALTER USER root@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;
</code></pre><h2><span id="创建mydb库并授权给root用户">创建mydb库并授权给root用户</span></h2><pre><code class="mysql">create database mydb;

grant all privileges on mydb.* to &#39;root&#39;@&#39;%&#39;;
flush privileges;
</code></pre><h1><span id="3-用navicat连接数据库并完成建表">3. 用navicat连接数据库并完成建表</span></h1><h2><span id="连接k8s下的mysql数据库">连接k8s下的MySQL数据库</span></h2><p>并建表，插入一条测试数据：</p><pre><code class="mysql">create table test0918(col1 varchar(100));
insert into test0918 values(&#39;aaa&#39;);
</code></pre><p>然后新建一个后续实验用到的表：</p><pre><code class="mysql">CREATE TABLE product_info(
product_name varchar (1000)
, supplier varchar (1000)
, supplier_web varchar (1000)
, product_desc varchar (1000)
,product_img varchar (1000)
, product_price varchar (1000)
, addr varchar (1000)
, mailing_ins varchar (1000))
</code></pre><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-18%20024723.png" alt="屏幕截图 2023-12-18 024723"></p><p>（此处找不到原图了，只得先用一张docker最终实验测试成功的截图）</p><h2><span id="连接docker下的mysql数据库">连接docker下的MySQL数据库</span></h2><p>建表语句同上</p><p><img loading="lazy" src="/../images/image-20231221002309917.png" alt="image-20231221002309917"></p><h1><span id="4-制作dockerfile并创建镜像运行容器">4. 制作dockerfile并创建镜像，运行容器</span></h1><blockquote><p>镜像中需要包含python环境，并且包含爬虫的数据解析包，并包含脚本的自动调度命令。</p></blockquote><h2><span id="1-创建定时任务的dockerfile">1. 创建定时任务的Dockerfile</span></h2><pre><code class="dockerfile"># 使用阿里云的CentOS 7镜像作为基础镜像
FROM centos:7

# 配置阿里云的yum源
RUN curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
RUN curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo
RUN yum makecache fast

# 安装cronie和更新系统
RUN yum -y install cronie.x86_64 &amp;&amp; \
    yum -y update

# 安装Python开发相关的工具
RUN yum install python3-devel python3-pip -y

# 安装Python依赖包，注意将 &quot;pip3 install urllib&quot; 替换为 &quot;pip3 install urllib3&quot;
RUN pip3 install -i https://pypi.douban.com/simple pymysql urllib3 beautifulsoup4

# 复制脚本和Python文件到容器内
COPY ./script.sh /script.sh
COPY ./mysql.py /mysql.py

# 添加执行权限
RUN chmod +x /script.sh
RUN chmod +x /mysql.py

# 设置定时任务
CMD crond -n
</code></pre><h2><span id="2-编写scriptsh和mysqlpy">2. 编写script.sh和mysql.py</span></h2><h3><span id="scriptsh">script.sh:</span></h3><pre><code class="bash">python3 /mysql.py &gt;&gt; /var/log/cron.log 2&gt;&amp;1
</code></pre><h3><span id="mysqlpy">mysql.py:</span></h3><blockquote><p>注意mysql.py中的数据库端口，这里docker中和k8s中并不一样</p></blockquote><pre><code class="python">#!/usr/bin/env python
# coding: utf-8

# In[1]:



import urllib.request
from time import sleep
from bs4 import BeautifulSoup as bs
from urllib.parse import urljoin
import pymysql


# In[2]:


headers = &#123;
    &#39;User-Agent&#39;: &#39;Mozilla/6.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36&#39;
&#125;


# In[3]:


def get_info(page):
    url=&#39;https://www.cnhnb.com/p/mianfen-0-0-0-0-&#123;&#125;/&#39;.format(page)
    req = urllib.request.Request(url, headers=headers)
    html = urllib.request.urlopen(req)
    soup = bs(html.read(), &#39;html.parser&#39;)
    lu = soup.find_all(&#39;div&#39;,class_=&#39;show-ctn&#39;)
    product_all=[]
    for i in lu:
        product_name=i.find(&#39;h2&#39;).get_text()#产品名称
        supplier=i.find(&quot;a&quot;).get_text()#供应商
        supplier_web=i.find(&quot;a&quot;).attrs[&#39;href&#39;]#供应商网址
        product_desc=i.find(&#39;div&#39;,class_=&#39;shop-image&#39;).img.attrs[&#39;alt&#39;]#产品介绍
        product_img=i.find(&#39;div&#39;,class_=&#39;shop-image&#39;).img.attrs[&#39;src&#39;]#产品图片
        product_price=str(i.find(&#39;div&#39;,class_=&#39;shops-price&#39;).get_text()).strip().replace(&#39;\n&#39;,&#39;&#39;).replace(&#39; &#39;,&#39;&#39;)#产品价格
        addr=str(i.find(&#39;div&#39;,class_=&#39;r-shop-btm&#39;).get_text())#发货地
        mailing_ins=str(i.find(&#39;div&#39;,class_=&#39;cw-tags&#39;).get_text()).strip().replace(&#39;\n&#39;,&#39;&#39;).replace(&#39; &#39;,&#39;&#39;)#邮寄说明
        product=[product_name,supplier,supplier_web,product_desc,product_img,product_price,addr,mailing_ins]
        product_all.append(product)
    return product_all


# In[12]:


def save_mysql(all_data):
    conn = pymysql.connect(host=&#39;192.168.154.130&#39;, user=&#39;root&#39;, port=31233, password=&#39;123456&#39;, db=&#39;mydb&#39;, charset=&#39;utf8&#39;)
    # 注意不要忘记换host
    curson = conn.cursor()
    # 创建表sql语句
    #ctablesql = &#39;CREATE TABLE product_info(product_name varchar (1000), supplier varchar (1000), supplier_web varchar (1000), product_desc varchar (1000),product_img varchar (1000), product_price varchar (1000), addr varchar (1000), mailing_ins varchar (1000))&#39;
    #curson.execute(ctablesql)
    # 插入数据SQL语句
    insertsql = &#39;insert into product_info(product_name,supplier,supplier_web,product_desc,product_img,product_price,addr,mailing_ins) value (%s,%s,%s,%s,%s,%s,%s,%s)&#39;
    for data in all_data:
        data = tuple(data)
        curson.execute(insertsql, data)
    conn.commit()


# In[13]:


if __name__ == &#39;__main__&#39;:
    for i in range(1,89):
        all_data=get_info(i)
        save_mysql(all_data)


# In[ ]:
</code></pre><h2><span id="3-利用dockerfile创建镜像">3. 利用Dockerfile创建镜像</span></h2><pre><code class="bash">docker build -t docker-crond .
</code></pre><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-18%20024855.png" alt="屏幕截图 2023-12-18 024855"></p><h2><span id="4-运行并进入容器内部配置定时任务若crond-未启动直接运行此命令">4. 运行并进入容器内部，配置定时任务（若crond 未启动，直接运行此命令）</span></h2><pre><code class="bash">docker run -it docker-crond /bin/bash
crond
crontab -e
</code></pre><p>添加如下内容：</p><pre><code>*/5 * * * * /script.sh &gt;&gt; /var/log/cron.log 2&gt;&amp;1
</code></pre><p><code>2&gt;&amp;1</code>是一个重定向操作符，用于将标准错误（文件描述符2）重定向到标准输出（文件描述符1）</p><p>验证：</p><pre><code class="bash">crontab -l
</code></pre><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-18%20024800.png" alt="屏幕截图 2023-12-18 024800"></p><h2><span id="5-查看数据库结果">5. 查看数据库结果</span></h2><blockquote><p>脚本运行起来之后，就可以通过navicat查看数据了，脚本调度调度失败，相关的失败日志信息就会写入到<code>/var/log/cron.log</code>中。</p></blockquote><h3><span id="k8s数据库结果">k8s数据库结果：</span></h3><p><img loading="lazy" src="/../images/image-20231221004706038.png" alt="image-20231221004706038"></p><h3><span id="docker数据库结果">docker数据库结果：</span></h3><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-20%20191548.png" alt="屏幕截图 2023-12-20 191548"></p><h1><span id="5-构建镜像并推送到阿里云镜像仓库">5. 构建镜像并推送到阿里云镜像仓库</span></h1><h2><span id="1-构建镜像">1. 构建镜像</span></h2><p>先停止容器，停止前记住容器id：</p><pre><code class="bash">docker ps
docker stop 容器id
</code></pre><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-18%20024628.png" alt="屏幕截图 2023-12-18 024628"></p><pre><code class="bash">docker commit 容器id 镜像名:版本号
</code></pre><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-18%20024613.png" alt="屏幕截图 2023-12-18 024613"></p><h2><span id="2-推送到阿里云镜像仓库">2. 推送到阿里云镜像仓库</span></h2><h3><span id="1-准备工作">1. 准备工作</span></h3><h4><span id="1-找到阿里云容器镜像服务acr并打开控制台">1. 找到阿里云容器镜像服务ACR，并打开控制台：</span></h4><p><img loading="lazy" src="/../images/image-20231221005222487.png" alt="image-20231221005222487"></p><h4><span id="2-找到个人实例先创建命名空间">2. 找到个人实例，先创建命名空间：</span></h4><p><img loading="lazy" src="/../images/image-20231221005513145.png" alt="image-20231221005513145"></p><h4><span id="3-在该命名空间下创建一个镜像仓库my-docker-crond注意地域">3. 在该命名空间下创建一个镜像仓库<code>my-docker-crond</code>，注意地域：</span></h4><p><img loading="lazy" src="/../images/image-20231221100311796.png" alt="image-20231221100311796"></p><blockquote><p>剩下的根据操作指南操作。</p></blockquote><h3><span id="2-登录阿里云docker-registry">2. 登录阿里云Docker Registry</span></h3><p><img loading="lazy" src="/../images/image-20231221011604426.png" alt="image-20231221011604426"></p><p><img loading="lazy" src="/../images/image-20231221011719764.png" alt="image-20231221011719764"></p><h3><span id="3-tagandpush">3. <code>tag</code>and<code>push</code></span></h3><p><img loading="lazy" src="/../images/image-20231221100619023.png" alt="image-20231221100619023"></p><p><img loading="lazy" src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-18%20024508.png" alt="屏幕截图 2023-12-18 024508"></p><h3><span id="4-仓库验证">4. 仓库验证</span></h3><p><img loading="lazy" src="/../images/image-20231221100517948.png" alt="image-20231221100517948"></p><h1><span id="实训总结">实训总结</span></h1><p>这次实训的重点在于搭建一主两从k8s集群，中间我遇到了各种各样的错误，我还是不能找到一个百分百搭建成功的方法，说实话，有点挫败感，不过我依然从中学到了很多知识，了解了k8s的基本架构，更重要的是，我锻炼了解决实际问题的能力。</p></div><div id="comment"><div id="twikoo-container"></div></div></div><footer id="footer"><div id="footer-wrap"><div>&copy; 2023 - 2024 Tianzhen <span id="footer-icon"><i class="fa-solid fa-font-awesome fa-fw"></i> </span>&commat;Tianzhen</div><div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp; <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a></div><a href="https://icp.gov.moe/?keyword=20236514" target="_blank">萌ICP备20236514号</a></div><div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("11/07/2023 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",250)</script></div></footer></div><transition name="fade"><div id="preview" ref="preview" v-show="previewShow"><img id="preview-content" ref="previewContent"></div></transition></div><script src="/api/js/main.js"></script><script>twikoo.init({el:"#twikoo-container",envId:"https://tiantwikoo.netlify.app/.netlify/functions/twikoo",region:"",path:location.pathname,lang:"zh"})</script></body><p style="text-align:center" id="saintwei"></p><script>var saintwei=function(r){var i=["现在开始天晴了！","天空比大海还要深，是个未知的世界。","天气因你逆转，世界因你天晴。","能遇见你真是太好了。","不管晴天还是雨天，我只是想和你相遇。","我只是想再一次的见到她啊!","是你让我找到了存在的意义。","无论你在哪里，我一定拼尽全力去见你。","拜托了，我们就这样一直在一起。","只是天空的样子，就能改变人们的心情。","天空上是另一个世界，自古如此。","我从来不知道，渴望蓝天的人居然有那么多。","天气真的是很不可思议，光只是天空的模样就让人感动不已。","这是一个只有我和她知道，关于这世界的秘密。","100%的晴天女孩？","在充满暴风雨的世界，一起勇敢地爱下去!","那年夏天，在那个天空之上的我们，把这个世界的样貌，彻底的改变了。","天空比大海还要深，是个未知的世界。","重要的人，想见的人，无论晴雨，不管多远，都一定要去见你！","晴天里有阳光，阳光总是充满温馨，相信有这么多朋友的厚爱和鼓励，晴天会永远阳光灿烂。","天晴得像一张蓝纸，几片薄薄的白云，像被阳光晒化了似的，随风缓缓浮游着。","天空澄碧，纤云不染，远山含黛，和风送暖。","浅蓝色的天幕，像一幅洁净的丝绒，镶着黄色的金边。","一场飘洒的雨后，阳光带着清醒的空气飞来，试问是哪位仙子的生日，阳光如此美丽。","晴天的午后，夏日的阳光如水般音符一样灿烂的流动，湿澈了不同的妩媚的忧伤。","天那么蓝，连一丝浮絮都没有，像被过滤了一切杂色，瑰丽地熠熠发光。","神明啊!求你!求你!求你!让我再见她一次！","比起晴空，我更需要阳菜，天气什么的，就这样疯狂下去也可以。"].map(function(t){return t}),n=["rgb(110,64,170)","rgb(150,61,179)","rgb(191,60,175)","rgb(228,65,157)","rgb(254,75,131)","rgb(255,94,99)","rgb(255,120,71)","rgb(251,150,51)","rgb(226,183,47)","rgb(198,214,60)","rgb(175,240,91)","rgb(127,246,88)","rgb(82,246,103)","rgb(48,239,130)","rgb(29,223,163)","rgb(26,199,194)","rgb(35,171,216)","rgb(54,140,225)","rgb(76,110,219)","rgb(96,84,200)"],l={text:"",prefixP:-5,skillI:0,skillP:0,direction:"forward",delay:2,step:1};!function t(){var e=i[l.skillI];l.step?l.step--:(l.step=1,l.prefixP<"".length?(0<=l.prefixP&&(l.text+=""[l.prefixP]),l.prefixP++):"forward"===l.direction?l.skillP<e.length?(l.text+=e[l.skillP],l.skillP++):l.delay?l.delay--:(l.direction="backward",l.delay=2):0<l.skillP?(l.text=l.text.slice(0,-1),l.skillP--):(l.skillI=(l.skillI+1)%i.length,l.direction="forward")),r.textContent=l.text,r.appendChild(function(t){for(var e=document.createDocumentFragment(),r=0;r<t;r++){var i=document.createElement("span");i.textContent=String.fromCharCode(94*Math.random()+33),i.style.color=n[Math.floor(Math.random()*n.length)],e.appendChild(i)}return e}(l.prefixP<"".length?Math.min(5,5+l.prefixP):Math.min(5,e.length-l.skillP))),setTimeout(t,75)}()};saintwei(document.getElementById("saintwei"))</script></html>